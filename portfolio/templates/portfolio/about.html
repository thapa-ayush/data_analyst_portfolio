{% extends 'portfolio/base.html' %}
{% load static %}

{% block title %}About {{ about.name }} | Data Analyst{% endblock %}
{% block meta_description %}Learn more about my background, experience, and education as a data analyst{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/about.css' %}">
{% endblock %}

{% block content %}
{% if about %}
<section class="about-section">
    <!-- About Hero -->
    <div class="about-hero">
        <!-- Profile Section -->
        <div class="about-profile">
            <div class="about-image">
                {% if about.profile_image %}
                <img src="{{ about.profile_image.url }}" alt="{{ about.name }}">
                {% else %}
                {{ about.name|first }}
                {% endif %}
            </div>
        </div>

        <!-- Bio Section -->
        <div>
            <p class="section-label">Get to know me</p>
            <h1>About Me</h1>
            <div class="about-bio">
                <p>{{ about.bio }}</p>
                <p>I'm passionate about turning raw data into actionable insights that drive business decisions. With
                    expertise in statistical analysis, data visualization, and business intelligence, I help
                    organizations understand their data and unlock its potential.</p>
            </div>
        </div>
    </div>
</section>

<!-- Experience Timeline -->
{% if experiences %}
<section class="about-section about-section-spaced">
    <p class="section-label">Professional History</p>
    <h2>Experience</h2>

    <div class="timeline">
        {% for exp in experiences %}
        <div class="timeline-item" style="position: relative;">
            <div class="timeline-dot"></div>
            <div class="timeline-content">
                <div class="timeline-title">{{ exp.position }}</div>
                <div class="timeline-subtitle">{{ exp.company }}{% if exp.location %} â€¢ {{ exp.location }}{% endif %}
                </div>
                <div class="timeline-date">{{ exp.start_date|date:"M Y" }} - {% if exp.current %}Present{% else %}{{
                    exp.end_date|date:"M Y" }}{% endif %}</div>
                <div class="timeline-description">{{ exp.description }}</div>
                {% if exp.achievements %}
                <ul class="achievements">
                    {% for achievement in exp.get_achievements_list %}
                    <li>{{ achievement }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Education -->
{% if education %}
<section class="about-section about-section-spaced">
    <p class="section-label">Academic Background</p>
    <h2>Education</h2>

    <div class="education-grid">
        {% for edu in education %}
        <div class="education-card {% if edu.certificate_image %}has-certificate{% endif %}">
            <div class="education-main">
                <div class="education-logo">
                    {% if edu.institution_logo %}
                    <img src="{{ edu.institution_logo.url }}" alt="{{ edu.institution }}">
                    {% else %}
                    <svg viewBox="0 0 24 24" fill="currentColor" class="education-logo-icon">
                        <path d="M12 3L1 9l11 6 9-4.91V17h2V9M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82z" />
                    </svg>
                    {% endif %}
                </div>
                <div class="education-info">
                    <h3>{{ edu.degree }}</h3>
                    <div class="education-subtitle">{{ edu.institution }}</div>
                    <div class="education-date">{{ edu.get_date_range }}</div>
                    <p class="education-field">{{ edu.field_of_study }}</p>
                    {% if edu.grade %}
                    <p class="education-grade">Grade: {{ edu.grade }}</p>
                    {% endif %}
                </div>
            </div>
            {% if edu.certificate_image %}
            <div class="education-certificate"
                onclick="openCertificateLightbox('{{ edu.certificate_image.url }}', '{{ edu.degree }} - {{ edu.institution }}')">
                <img src="{{ edu.certificate_image.url }}" alt="{{ edu.degree }} Certificate">
                <div class="certificate-overlay">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="20" height="20">
                        <path
                            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
                        <path d="M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z" />
                    </svg>
                    <span>View Certificate</span>
                </div>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</section>

<!-- Certificate Lightbox -->
<div id="certificateLightbox" class="certificate-lightbox" onclick="closeCertificateLightbox()">
    <span class="lightbox-close" onclick="closeCertificateLightbox()">&times;</span>
    <img id="certificateLightboxImg" class="lightbox-content" src="" alt="">
    <div id="certificateLightboxCaption" class="lightbox-caption"></div>
</div>
{% endif %}

<!-- Skills Summary -->
{% if skills %}
<section class="about-section about-section-spaced skills-summary-section">
    <p class="section-label">Technical Proficiencies</p>
    <h2>Skills Summary</h2>

    <div class="skills-grid-compact">
        {% regroup skills by category as skill_categories %}
        {% for category in skill_categories %}
        <div class="skill-category-card">
            <div class="skill-category-header">
                <div class="skill-category-icon">
                    {% if category.grouper == 'technical' %}
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" />
                    </svg>
                    {% elif category.grouper == 'soft' %}
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 2a9 9 0 00-9 9c0 4.17 2.84 7.67 6.69 8.69L12 22l2.31-2.31C18.16 18.67 21 15.17 21 11a9 9 0 00-9-9zm0 16c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z" />
                        <path
                            d="M12 6c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 8c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3z" />
                    </svg>
                    {% elif category.grouper == 'tools' %}
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                    </svg>
                    {% elif category.grouper == 'analytics' %}
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                    </svg>
                    {% else %}
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M11 21h-1l1-7H7.5c-.58 0-.57-.32-.38-.66.19-.34.05-.08.07-.12C8.48 10.94 10.42 7.54 13 3h1l-1 7h3.5c.49 0 .56.33.47.51l-.07.15C12.96 17.55 11 21 11 21z" />
                    </svg>
                    {% endif %}
                </div>
                <h3 class="skill-category-title">{{ category.grouper|title }}</h3>
            </div>
            {% for skill in category.list %}
            <div class="skill-item">
                <div class="skill-item-header">
                    <div class="skill-name">
                        <span class="skill-icon">{{ skill.get_icon_svg|safe }}</span>
                        <span>{{ skill.name }}</span>
                    </div>
                    <span class="skill-percentage">{{ skill.proficiency }}%</span>
                </div>
                <div class="skill-bar-container">
                    <div class="skill-bar" style="width: {{ skill.proficiency|default_if_none:'0'|floatformat:0 }}%;">
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</section>
{% endif %}

<!-- Certifications Section -->
{% if certificates %}
<section class="about-section about-section-spaced">
    <p class="section-label">Credentials</p>
    <h2>Certifications</h2>

    <div class="cert-grid">
        {% for cert in certificates %}
        <div class="about-cert-card">
            <div class="cert-image">
                {% if cert.certificate_image %}
                <img src="{{ cert.certificate_image.url }}" alt="{{ cert.certificate_name }}">
                {% else %}
                <svg viewBox="0 0 24 24" fill="currentColor" class="cert-placeholder-icon">
                    <path
                        d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
                {% endif %}
            </div>
            <div class="cert-content">
                <h3 class="cert-title">{{ cert.certificate_name }}</h3>
                <p class="cert-issuer">{{ cert.issuing_organization }}</p>
                {% if cert.expiry_date %}
                {% if cert.expiry_date > now %}
                <span class="cert-badge active">Active</span>
                {% else %}
                <span class="cert-badge expired">Expired</span>
                {% endif %}
                {% else %}
                <span class="cert-badge permanent">Permanent</span>
                {% endif %}
                <div class="cert-date">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                        <path
                            d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2z" />
                    </svg>
                    <span>Issued: {{ cert.issue_date|date:"M Y" }}</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="section-center">
        <a href="{% url 'certificates' %}" class="btn btn-primary">View All Certifications</a>
    </div>
</section>
{% endif %}

<!-- Featured Projects -->
{% if projects %}
<section class="about-section about-section-spaced">
    <p class="section-label">My Work</p>
    <h2>Featured Projects</h2>

    <div class="projects-grid">
        {% for project in projects %}
        <div class="about-project-card">
            <div class="project-image">
                {% if project.image %}
                <img src="{{ project.image.url }}" alt="{{ project.title }}">
                {% else %}
                <svg viewBox="0 0 24 24" fill="currentColor" class="project-placeholder-icon">
                    <path d="M3.5 18.5l6-6 4 4L22 6.92 20.59 5.5l-7.09 8.58-4-4L2 18.5h1.5z" />
                </svg>
                {% endif %}
            </div>
            <div class="project-content">
                <h3 class="project-title">{{ project.title }}</h3>
                <p class="project-desc">{{ project.description|truncatewords:20 }}</p>
                {% if project.project_url or project.github_url %}
                <div class="project-buttons">
                    {% if project.project_url %}
                    <a href="{{ project.project_url }}" target="_blank" class="btn btn-primary btn-sm">View Project</a>
                    {% endif %}
                    {% if project.github_url %}
                    <a href="{{ project.github_url }}" target="_blank" class="btn btn-secondary btn-sm">GitHub</a>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="section-center">
        <a href="{% url 'projects' %}" class="btn btn-secondary">View All Projects</a>
    </div>
</section>
{% endif %}

<!-- Contact CTA -->
<section class="about-cta-section">
    <h2>Ready to Collaborate?</h2>
    <p>I'm always interested in discussing data analytics projects and opportunities.</p>
    <a href="{% url 'contact' %}" class="btn btn-primary">Get In Touch</a>
</section>

{% else %}
<section class="about-empty">
    <h2>About Section Coming Soon</h2>
    <p>Profile information will appear here. Add your details in the admin panel.</p>
</section>
{% endif %}

<script>
    function openCertificateLightbox(src, caption) {
        const lightbox = document.getElementById('certificateLightbox');
        const img = document.getElementById('certificateLightboxImg');
        const captionEl = document.getElementById('certificateLightboxCaption');

        lightbox.style.display = 'flex';
        img.src = src;
        captionEl.textContent = caption || '';
        document.body.style.overflow = 'hidden';
    }

    function closeCertificateLightbox() {
        const lightbox = document.getElementById('certificateLightbox');
        lightbox.style.display = 'none';
        document.body.style.overflow = '';
    }

    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeCertificateLightbox();
        }
    });
</script>
{% endblock %}