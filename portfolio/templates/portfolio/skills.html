{% extends 'portfolio/base.html' %}
{% load static %}

{% block title %}Skills | Data Analyst Portfolio{% endblock %}
{% block meta_description %}Technical and soft skills in data analytics and business intelligence{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/skills.css' %}">
{% endblock %}

{% block content %}
<section>
    <p class="section-label">My Expertise</p>
    <h2>Skills & Technologies</h2>
    <p class="skills-intro">A comprehensive overview of my technical abilities and competencies in data
        analytics and related fields.</p>

    {% if skills %}
    <!-- Filter Tabs -->
    <div class="skills-filter">
        <button class="filter-btn active" data-filter="all">All Skills</button>
        {% regroup skills by category as category_list %}
        {% for category in category_list %}
        <button class="filter-btn" data-filter="{{ category.grouper|slugify }}">{{ category.grouper }}</button>
        {% endfor %}
    </div>

    <!-- Skills by Category -->
    {% regroup skills by category as category_list %}
    {% for category in category_list %}
    <div class="skills-category" data-category="{{ category.grouper|slugify }}">
        <h3 class="category-title">{{ category.grouper }}</h3>

        <div class="skills-grid">
            {% for skill in category.list %}
            <div class="skill-card">
                <div class="skill-header">
                    <div class="skill-icon">
                        {% if skill.icon_svg %}
                        {{ skill.icon_svg|safe }}
                        {% else %}
                        <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
                            <path
                                d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z" />
                        </svg>
                        {% endif %}
                    </div>
                    <div class="skill-info">
                        <h4 class="skill-name">{{ skill.name }}</h4>
                        <span class="proficiency-label">{{ skill.get_proficiency_display }}</span>
                    </div>
                </div>

                <div class="proficiency-bar">
                    <div class="proficiency-fill proficiency-{{ skill.proficiency }}"
                        data-value="{{ skill.proficiency_percentage }}">
                    </div>
                </div>

                {% if skill.description %}
                <p class="skill-description">{{ skill.description }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <script>
        // Filter functionality
        const filterBtns = document.querySelectorAll('.filter-btn');
        const categories = document.querySelectorAll('.skills-category');

        filterBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                // Update active button
                filterBtns.forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                const filter = this.dataset.filter;

                // Show/hide categories
                categories.forEach(category => {
                    if (filter === 'all' || category.dataset.category === filter) {
                        category.style.display = 'block';
                    } else {
                        category.style.display = 'none';
                    }
                });
            });
        });

        // Animate proficiency bars on scroll
        const observerOptions = {
            threshold: 0.3,
            rootMargin: '0px 0px -50px 0px'
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const fills = entry.target.querySelectorAll('.proficiency-fill');
                    fills.forEach(fill => {
                        fill.style.width = fill.dataset.value + '%';
                    });
                    observer.unobserve(entry.target);
                }
            });
        }, observerOptions);

        categories.forEach(category => observer.observe(category));
    </script>

    {% else %}
    <div class="empty-state">
        <h3>No Skills Added Yet</h3>
        <p>Skills will appear here once you add them in the admin panel.</p>
    </div>
    {% endif %}
</section>
{% endblock %}